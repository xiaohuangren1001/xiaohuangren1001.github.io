
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../05-read-kernel-and-into-32/">
      
      
        <link rel="next" href="../07-print-impl/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>06 重新放置内核并进入内核 - Oildum/Atklom's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0253249f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/style.css">
    
      <link rel="stylesheet" href="../../../assets/highlight.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Oildum/Atklom&#39;s Blog" class="md-header__button md-logo" aria-label="Oildum/Atklom's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Oildum/Atklom's Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              06 重新放置内核并进入内核
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  主页

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  操作系统教程

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Oildum/Atklom&#39;s Blog" class="md-nav__button md-logo" aria-label="Oildum/Atklom's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Oildum/Atklom's Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    主页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    操作系统教程
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            操作系统教程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    旧教程
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            旧教程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00-beforestart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    00 开始之前
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-first-boot-sector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01 第一个引导扇区
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-fat12-file-system/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02 FAT12 文件系统
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-find-loader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03 查找 Loader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-load-and-jump-into-loader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    04 加载并跳入 Loader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-read-kernel-and-into-32/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    05 读取内核并进入保护模式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    06 重新放置内核并进入内核
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-print-impl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    07 实现我们自己的打印函数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-we-love-makefile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    08 整理文件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-gdtidt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    09 重设 GDT、IDT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-irq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10 接收外部中断，从时钟开始
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-seg-memman/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11 段式内存管理的实现
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-multitasking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12 多任务
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-kbd-part0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    13 终于可以打字了——键盘驱动（上）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../14-kbd-part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    14 终于可以打字了——键盘驱动（下）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../15-syscall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    15 系统调用——应用程序与系统的交互之门
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../16-shell-d-and-i/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    16 shell的设计与实现
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../17-fat16-part0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    17 实现FAT16文件系统（1）——基础设施建设：硬盘驱动、RTC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../18-fat16-part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    18 实现FAT16文件系统（2）——格式化、打开文件、创建文件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../19-fat16-part2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    19 实现FAT16文件系统（3）——读取文件、写入文件、删除文件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../20-fat16-part3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    20 实现FAT16文件系统（4）——上层包装
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../21-fat16-part4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    21 FAT16 文件系统实战——抛弃软盘，从硬盘启动
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../22-first-app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    22 第一个应用程序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../23-c-app-part0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    23 C语言应用程序（上）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../24-c-app-part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    24 C语言应用程序（下）
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../new/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    新教程
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            新教程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>06 重新放置内核并进入内核</h1>

<p>进入保护模式之后我们的目标只有一个，那就是随之跳入内核。不过，既然我们的内核是有格式的（<code>ELF</code>），我们需要先分析一下 <code>ELF</code> 格式到底长什么样子，如下图所示：</p>
<p><img alt="" src="../images/graph-6-1.png" /></p>
<p>（图 6-1 <code>ELF</code> 文件结构）</p>
<p>由于我们需要寻找的是真正的二进制代码的所在位置，所以我们先直接进入对 <code>Program Header</code> 的分析。此处用表就不太合适了，下面的代码便是对 <code>Program Header</code> 结构的描述：</p>
<p><strong>代码 6-1 <code>Program Header</code></strong>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">p_type</span><span class="p">;</span><span class="w">   </span><span class="c1">// 当前header描述的段类型</span>
<span class="w">    </span><span class="n">Elf32_Off</span><span class="w">  </span><span class="n">p_offset</span><span class="p">;</span><span class="w"> </span><span class="c1">// 段的第一个字节在文件中的偏移</span>
<span class="w">    </span><span class="n">Elf32_Addr</span><span class="w"> </span><span class="n">p_vaddr</span><span class="p">;</span><span class="w">  </span><span class="c1">// 段在内存中的虚拟地址</span>
<span class="w">    </span><span class="n">Elf32_Addr</span><span class="w"> </span><span class="n">p_paddr</span><span class="p">;</span><span class="w">  </span><span class="c1">// 段在内存中的物理地址，为兼容不进入保护模式的OS</span>
<span class="w">    </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">p_filesz</span><span class="p">;</span><span class="w"> </span><span class="c1">// 段在文件中的长度</span>
<span class="w">    </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">p_memsz</span><span class="p">;</span><span class="w">  </span><span class="c1">// 段在内存中的长度</span>
<span class="w">    </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">p_flags</span><span class="p">;</span><span class="w">  </span><span class="c1">// 与段相关的标志</span>
<span class="w">    </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">p_align</span><span class="p">;</span><span class="w">  </span><span class="c1">// 确定段在文件和内存中如何对齐</span>
<span class="p">}</span><span class="w"> </span><span class="n">Elf32_Phdr</span><span class="p">;</span>
</code></pre></div></p>
<p>其中的所有数据类型（<code>Elf32_Word</code>、<code>Elf32_Off</code> 和 <code>Elf32_Addr</code>） 均为大小为 <code>4</code>、对齐也为 <code>4</code> 的无符号类型，而 <code>Word</code> 为大整数，<code>Off</code> 为偏移，<code>Addr</code> 为地址。</p>
<blockquote>
<p>那么如果一段 <code>ELF</code> 有很多个段该怎么办？我们怎么知道这个 <code>ELF</code> 段的数量？</p>
</blockquote>
<p>这时我们就需要前面的 <code>ELF header</code> 了，下面的代码是它的结构：</p>
<p><strong>代码 6-2 <code>ELF</code> 头</strong>
<div class="highlight"><pre><span></span><code><span class="cp">#define EI_NIDENT 16</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">e_ident</span><span class="p">[</span><span class="n">EI_NIDENT</span><span class="p">];</span><span class="w"> </span><span class="c1">// ELF特征标</span>

<span class="w">    </span><span class="n">Elf32_Half</span><span class="w"> </span><span class="n">e_type</span><span class="p">;</span><span class="w">      </span><span class="c1">// 文件类型</span>
<span class="w">    </span><span class="n">Elf32_Half</span><span class="w"> </span><span class="n">e_machine</span><span class="p">;</span><span class="w">   </span><span class="c1">// 运行至少需要的体系结构</span>
<span class="w">    </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">e_version</span><span class="p">;</span><span class="w">   </span><span class="c1">// 文件版本</span>
<span class="w">    </span><span class="n">Elf32_Addr</span><span class="w"> </span><span class="n">e_entry</span><span class="p">;</span><span class="w">     </span><span class="c1">// 程序的入口点</span>
<span class="w">    </span><span class="n">Elf32_Off</span><span class="w">  </span><span class="n">e_phoff</span><span class="p">;</span><span class="w">     </span><span class="c1">// Program Header 表的偏移</span>
<span class="w">    </span><span class="n">Elf32_Off</span><span class="w">  </span><span class="n">e_shoff</span><span class="p">;</span><span class="w">     </span><span class="c1">// Section Header 表的偏移</span>
<span class="w">    </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">e_flags</span><span class="p">;</span><span class="w">     </span><span class="c1">// 对于32位系统为0</span>
<span class="w">    </span><span class="n">Elf32_Half</span><span class="w"> </span><span class="n">e_ehsize</span><span class="p">;</span><span class="w">    </span><span class="c1">// ELF Header 的大小，单位字节</span>
<span class="w">    </span><span class="n">Elf32_Half</span><span class="w"> </span><span class="n">e_phentsize</span><span class="p">;</span><span class="w"> </span><span class="c1">// Program Header 的大小</span>
<span class="w">    </span><span class="n">Elf32_Half</span><span class="w"> </span><span class="n">e_phnum</span><span class="p">;</span><span class="w">     </span><span class="c1">// Program Header 的数量</span>
<span class="w">    </span><span class="n">Elf32_Half</span><span class="w"> </span><span class="n">e_shentsize</span><span class="p">;</span><span class="w"> </span><span class="c1">// Section Header 的大小</span>
<span class="w">    </span><span class="n">Elf32_Half</span><span class="w"> </span><span class="n">e_shnum</span><span class="p">;</span><span class="w">     </span><span class="c1">// Section Header 的数量</span>
<span class="w">    </span><span class="n">Elf32_Half</span><span class="w"> </span><span class="n">e_shstrndx</span><span class="p">;</span><span class="w">  </span><span class="c1">// 包含 Section 名称的字符串表位于哪一项</span>
<span class="p">}</span><span class="w"> </span><span class="n">Elf32_Ehdr</span><span class="p">;</span>
</code></pre></div></p>
<p>其中出现的新类型只有 <code>Elf32_Half</code>（<code>unsigned char</code> 大家肯定很熟悉就不算了），它代表一个无符号中等大小整数，大小和对齐均为 <code>2</code> 字节。</p>
<p>对于 <code>ELF</code> 的研究就到此为止，后续的细节我们在代码当中说明……但此时还有一个小问题，下图是目前的 <code>kernel.bin</code> 的样子。</p>
<p><img alt="" src="../images/graph-6-2.png" /></p>
<p>（图 6-2 目前的 <code>kernel.bin</code>）</p>
<p>我用蓝色标出来的位置，根据计算不难发现是 <code>e_entry</code>，它已经位于0x8000000（128MB）以外，但根据我们的默认设置，我们的内存大小只有128MB。另一方面来讲我们可以通过分页来调低这个位置，但它的具体位置也是不可控的。</p>
<p>那么我们就只剩下一条路了：手动更改 <code>e_entry</code> 的值。事实上，这个过程只需要修改一下编译命令：</p>
<div class="highlight"><pre><span></span><code>nasm -f elf -o kernel.o kernel.asm
i686-elf-ld -s -Ttext 0x100000 -o kernel.bin kernel.o
</code></pre></div>
<p>我们把它的入口点定在了 <code>0x100000</code>，因为这里刚好是1MB，可以避开前面错综复杂的势力。</p>
<p>说了这么半天，我们到底如何重新放置内核？根据前面的分析，我们只需要重复执行与下列 <code>C</code> 语句相同的指令即可：</p>
<p><strong>代码 6-3 我们的目标</strong>
<div class="highlight"><pre><span></span><code><span class="n">memcpy</span><span class="p">(</span><span class="n">p_vaddr</span><span class="p">,</span><span class="w"> </span><span class="n">BaseOfKernelFilePhyAddr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p_offset</span><span class="p">,</span><span class="w"> </span><span class="n">p_filesz</span><span class="p">);</span>
</code></pre></div></p>
<p>这时候我们忽然惊奇地发现，我们还没有内存拷贝用的函数，而且连保护模式下的堆栈都没有，甚至对各种段寄存器的处理都欠佳。不要紧，马上修改：</p>
<p><strong>代码 6-4 修整保护模式（loader.asm）</strong>
<div class="highlight"><pre><span></span><code><span class="err">[</span><span class="nf">section</span><span class="w"> </span><span class="no">.s32</span><span class="p">]</span>
<span class="nf">align</span><span class="w"> </span><span class="mi">32</span>
<span class="err">[</span><span class="nf">bits</span><span class="w"> </span><span class="mi">32</span><span class="p">]</span>
<span class="nl">LABEL_PM_START:</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">ax</span><span class="p">,</span><span class="w"> </span><span class="no">SelectorVideo</span><span class="w"> </span><span class="c1">; 按照保护模式的规矩来</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">gs</span><span class="p">,</span><span class="w"> </span><span class="no">ax</span><span class="w">            </span><span class="c1">; 把选择子装入gs</span>

<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">ax</span><span class="p">,</span><span class="w"> </span><span class="no">SelectorFlatRW</span><span class="w"> </span><span class="c1">; 数据段</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">ds</span><span class="p">,</span><span class="w"> </span><span class="no">ax</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">es</span><span class="p">,</span><span class="w"> </span><span class="no">ax</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">fs</span><span class="p">,</span><span class="w"> </span><span class="no">ax</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">ss</span><span class="p">,</span><span class="w"> </span><span class="no">ax</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">esp</span><span class="p">,</span><span class="w"> </span><span class="no">TopOfStack</span>

<span class="c1">; cs的设定已在之前的远跳转中完成</span>

<span class="w">    </span><span class="nf">jmp</span><span class="w"> </span><span class="no">$</span>

<span class="nl">MemCpy:</span><span class="w"> </span><span class="c1">; ds:参数2 ==&gt; es:参数1，大小：参数3</span>
<span class="w">    </span><span class="nf">push</span><span class="w"> </span><span class="no">ebp</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">ebp</span><span class="p">,</span><span class="w"> </span><span class="no">esp</span><span class="w"> </span><span class="c1">; 保存ebp和esp的值</span>

<span class="w">    </span><span class="nf">push</span><span class="w"> </span><span class="no">esi</span>
<span class="w">    </span><span class="nf">push</span><span class="w"> </span><span class="no">edi</span>
<span class="w">    </span><span class="nf">push</span><span class="w"> </span><span class="no">ecx</span><span class="w"> </span><span class="c1">; 暂存这三个，要用</span>

<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">edi</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">ebp</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">8</span><span class="p">]</span><span class="w"> </span><span class="c1">; [esp + 4] ==&gt; 第一个参数，目标内存区</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">esi</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">ebp</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">12</span><span class="p">]</span><span class="w"> </span><span class="c1">; [esp + 8] ==&gt; 第二个参数，源内存区</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">ebp</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">16</span><span class="p">]</span><span class="w"> </span><span class="c1">; [esp + 12] ==&gt; 第三个参数，拷贝的字节大小</span>
<span class="nl">.1:</span>
<span class="w">    </span><span class="nf">cmp</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="c1">; if (ecx == 0)</span>
<span class="w">    </span><span class="nf">jz</span><span class="w"> </span><span class="no">.2</span><span class="w"> </span><span class="c1">; goto .2;</span>

<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">al</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">ds</span><span class="p">:</span><span class="no">esi</span><span class="p">]</span><span class="w"> </span><span class="c1">; 从源内存区中获取一个值</span>
<span class="w">    </span><span class="nf">inc</span><span class="w"> </span><span class="no">esi</span><span class="w"> </span><span class="c1">; 源内存区地址+1</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">byte</span><span class="w"> </span><span class="p">[</span><span class="no">es</span><span class="p">:</span><span class="no">edi</span><span class="p">],</span><span class="w"> </span><span class="no">al</span><span class="w"> </span><span class="c1">; 将该值写入目标内存</span>
<span class="w">    </span><span class="nf">inc</span><span class="w"> </span><span class="no">edi</span><span class="w"> </span><span class="c1">; 目标内存区地址+1</span>

<span class="w">    </span><span class="nf">dec</span><span class="w"> </span><span class="no">ecx</span><span class="w"> </span><span class="c1">; 拷贝字节数大小-1</span>
<span class="w">    </span><span class="nf">jmp</span><span class="w"> </span><span class="no">.1</span><span class="w"> </span><span class="c1">; 重复执行</span>
<span class="nl">.2:</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">ebp</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">8</span><span class="p">]</span><span class="w"> </span><span class="c1">; 目标内存区作为返回值</span>

<span class="w">    </span><span class="nf">pop</span><span class="w"> </span><span class="no">ecx</span><span class="w"> </span><span class="c1">; 以下代码恢复堆栈</span>
<span class="w">    </span><span class="nf">pop</span><span class="w"> </span><span class="no">edi</span>
<span class="w">    </span><span class="nf">pop</span><span class="w"> </span><span class="no">esi</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">esp</span><span class="p">,</span><span class="w"> </span><span class="no">ebp</span>
<span class="w">    </span><span class="nf">pop</span><span class="w"> </span><span class="no">ebp</span>

<span class="w">    </span><span class="nf">ret</span>

<span class="err">[</span><span class="nf">section</span><span class="w"> </span><span class="no">.data1</span><span class="p">]</span>
<span class="nl">StackSpace:</span><span class="w"> </span><span class="nf">times</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="no">db</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="c1">; 栈暂且先给1KB</span>
<span class="nf">TopOfStack</span><span class="w">  </span><span class="no">equ</span><span class="w"> </span><span class="no">$</span><span class="w"> </span><span class="p">-</span><span class="w"> </span><span class="no">StackSpace</span><span class="w"> </span><span class="c1">; 栈顶</span>
</code></pre></div></p>
<p>下面便是本节最后的工作了。首先我们重新放置内核：</p>
<p><strong>代码 6-5 重新放置内核（loader.asm）</strong>
<div class="highlight"><pre><span></span><code><span class="err">[</span><span class="nf">section</span><span class="w"> </span><span class="no">.s32</span><span class="p">]</span>
<span class="nf">align</span><span class="w"> </span><span class="mi">32</span>
<span class="err">[</span><span class="nf">bits</span><span class="w"> </span><span class="mi">32</span><span class="p">]</span>
<span class="nl">LABEL_PM_START:</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">ax</span><span class="p">,</span><span class="w"> </span><span class="no">SelectorVideo</span><span class="w"> </span><span class="c1">; 按照保护模式的规矩来</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">gs</span><span class="p">,</span><span class="w"> </span><span class="no">ax</span><span class="w">            </span><span class="c1">; 把选择子装入gs</span>

<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">ax</span><span class="p">,</span><span class="w"> </span><span class="no">SelectorFlatRW</span><span class="w"> </span><span class="c1">; 数据段</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">ds</span><span class="p">,</span><span class="w"> </span><span class="no">ax</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">es</span><span class="p">,</span><span class="w"> </span><span class="no">ax</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">fs</span><span class="p">,</span><span class="w"> </span><span class="no">ax</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">ss</span><span class="p">,</span><span class="w"> </span><span class="no">ax</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">esp</span><span class="p">,</span><span class="w"> </span><span class="no">TopOfStack</span>

<span class="c1">; cs的设定已在之前的远跳转中完成</span>

<span class="w">    </span><span class="nf">call</span><span class="w"> </span><span class="no">InitKernel</span><span class="w"> </span><span class="c1">; 重新放置内核</span>

<span class="w">    </span><span class="nf">jmp</span><span class="w"> </span><span class="no">$</span>

<span class="na">...略去MemCpy...</span>

<span class="nl">InitKernel:</span>
<span class="w">    </span><span class="nf">xor</span><span class="w"> </span><span class="no">esi</span><span class="p">,</span><span class="w"> </span><span class="no">esi</span><span class="w"> </span><span class="c1">; esi = 0;</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">cx</span><span class="p">,</span><span class="w"> </span><span class="no">word</span><span class="w"> </span><span class="p">[</span><span class="no">BaseOfKernelFilePhyAddr</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">2</span><span class="no">Ch</span><span class="p">]</span><span class="w"> </span><span class="c1">; 这个内存地址存放的是ELF头中的e_phnum，即Program Header的个数</span>
<span class="w">    </span><span class="nf">movzx</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="no">cx</span><span class="w"> </span><span class="c1">; ecx高16位置0，低16位置入cx</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">esi</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">BaseOfKernelFilePhyAddr</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">1</span><span class="no">Ch</span><span class="p">]</span><span class="w"> </span><span class="c1">; 这个内存地址中存放的是ELF头中的e_phoff，即Program Header表的偏移</span>
<span class="w">    </span><span class="nf">add</span><span class="w"> </span><span class="no">esi</span><span class="p">,</span><span class="w"> </span><span class="no">BaseOfKernelFilePhyAddr</span><span class="w"> </span><span class="c1">; Program Header表的具体位置</span>
<span class="nl">.Begin:</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">esi</span><span class="p">]</span><span class="w"> </span><span class="c1">; 首先看一下段类型</span>
<span class="w">    </span><span class="nf">cmp</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="c1">; 段类型：PT_NULL或此处不存在Program Header</span>
<span class="w">    </span><span class="nf">jz</span><span class="w"> </span><span class="no">.NoAction</span><span class="w"> </span><span class="c1">; 本轮循环不执行任何操作</span>
<span class="w">    </span><span class="c1">; 否则的话：</span>
<span class="w">    </span><span class="nf">push</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="p">[</span><span class="no">esi</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">010</span><span class="no">h</span><span class="p">]</span><span class="w"> </span><span class="c1">; p_filesz</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">esi</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">04</span><span class="no">h</span><span class="p">]</span><span class="w"> </span><span class="c1">; p_offset</span>
<span class="w">    </span><span class="nf">add</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="no">BaseOfKernelFilePhyAddr</span><span class="w"> </span><span class="c1">; BaseOfKernelFilePhyAddr + p_offset</span>
<span class="w">    </span><span class="nf">push</span><span class="w"> </span><span class="no">eax</span>
<span class="w">    </span><span class="nf">push</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="p">[</span><span class="no">esi</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">08</span><span class="no">h</span><span class="p">]</span><span class="w"> </span><span class="c1">; p_vaddr</span>
<span class="w">    </span><span class="nf">call</span><span class="w"> </span><span class="no">MemCpy</span><span class="w"> </span><span class="c1">; 执行一次拷贝</span>
<span class="w">    </span><span class="nf">add</span><span class="w"> </span><span class="no">esp</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="c1">; 清理堆栈</span>
<span class="nl">.NoAction:</span><span class="w"> </span><span class="c1">; 本轮循环的清理工作</span>
<span class="w">    </span><span class="nf">add</span><span class="w"> </span><span class="no">esi</span><span class="p">,</span><span class="w"> </span><span class="mi">020</span><span class="no">h</span><span class="w"> </span><span class="c1">; 下一个Program Header</span>
<span class="w">    </span><span class="nf">dec</span><span class="w"> </span><span class="no">ecx</span>
<span class="w">    </span><span class="nf">jnz</span><span class="w"> </span><span class="no">.Begin</span><span class="w"> </span><span class="c1">; jz过来的话就直接ret了</span>

<span class="w">    </span><span class="nf">ret</span>
</code></pre></div></p>
<p>其中又有很多新的常量：</p>
<p><strong>代码 6-6 新常量（load.inc）</strong>
<div class="highlight"><pre><span></span><code><span class="nf">BaseOfLoader</span><span class="w">            </span><span class="no">equ</span><span class="w"> </span><span class="mi">09000</span><span class="no">h</span><span class="w"> </span><span class="c1">; Loader的基址</span>
<span class="nf">OffsetOfLoader</span><span class="w">          </span><span class="no">equ</span><span class="w"> </span><span class="mi">0100</span><span class="no">h</span><span class="w">  </span><span class="c1">; Loader的偏移</span>

<span class="nf">BaseOfLoaderPhyAddr</span><span class="w">     </span><span class="no">equ</span><span class="w"> </span><span class="no">BaseOfLoader</span><span class="w"> </span><span class="p">*</span><span class="w"> </span><span class="mi">10</span><span class="no">h</span><span class="w"> </span><span class="c1">; Loader被装载到的物理地址</span>

<span class="nf">BaseOfKernelFile</span><span class="w">            </span><span class="no">equ</span><span class="w"> </span><span class="mi">08000</span><span class="no">h</span><span class="w"> </span><span class="c1">; Kernel的基址</span>
<span class="nf">OffsetOfKernelFile</span><span class="w">          </span><span class="no">equ</span><span class="w"> </span><span class="mi">0</span><span class="no">h</span><span class="w">  </span><span class="c1">; Kernel的偏移</span>

<span class="nf">BaseOfKernelFilePhyAddr</span><span class="w">     </span><span class="no">equ</span><span class="w"> </span><span class="no">BaseOfKernelFile</span><span class="w"> </span><span class="p">*</span><span class="w"> </span><span class="mi">10</span><span class="no">h</span><span class="w"> </span><span class="c1">; Kernel被装载到的物理地址</span>
<span class="nf">KernelEntryPointPhyAddr</span><span class="w">     </span><span class="no">equ</span><span class="w"> </span><span class="mi">0x100000</span><span class="w"> </span><span class="c1">; Kernel入口点，一定要与编译命令一致！！！</span>
</code></pre></div></p>
<p>可能有聪明的读者就要问了：</p>
<blockquote>
<p>所以为啥不Init完直接进呢？？？</p>
</blockquote>
<p>有点仪式感（bushi），你看之前进 <code>Loader</code>，一点仪式感没有，平平淡淡地就进了（</p>
<p>好那么我们最后重视一下这仪式感吧，下面是进入内核的远跳转，请用它代替 <code>jmp $</code>：</p>
<p><strong>代码 6-7 跳入内核（loader.asm）</strong>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nf">jmp</span><span class="w"> </span><span class="no">SelectorFlatC</span><span class="p">:</span><span class="no">KernelEntryPointPhyAddr</span>
</code></pre></div></p>
<p>运行结果如图：</p>
<p><img alt="" src="../images/graph-6-3.png" /></p>
<p>（图 6-3 运行结果）</p>
<p>运行地非常成功，这不仅代表着我们可以让汇编仅起辅助作用，更是我们的操作系统的一个重要成果。</p>
<p>但是我既没有说后面不用汇编，也没有说 <code>Loader</code> 的工作到此结束，事实上后面我们可能还要再对 <code>Loader</code> 进行一次大改。</p>
<p>那么我们就暂时维持着 <code>Kernel</code> 现在的样子，进入下一节的内容。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
        <div class="md-copyright__highlight">
          本文档采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享 署名-相同方式共享 4.0 协议</a> 进行许可。
        </div>
        <div class="md-copyright__highlight">
          Copyright &copy; 2024 Oildum. Powered by mkdocs. Special thanks to copi143 for providing the theme and scripts.
        </div>
      </div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.tooltips", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.instant.preview", "navigation.sections", "navigation.tracking", "navigation.tabs", "navigation.path", "navigation.indexes", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "search.share"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>